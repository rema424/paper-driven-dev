# Experiment Protocol v1: Paper-Driven Development Full Paper

> **Protocol version**: v1
> **Date**: 2026-02-20
> **Status**: Draft（Codex レビュー後に Git tag で固定予定）
> **Prior work**: Phase 1 探索的ケーススタディ（N=2, GPT-5.2, 3条件+Bバリアント比較）

---

## 1. 研究の目的

Phase 1（探索的ケーススタディ）で観察されたパターン——co-primary 2指標（conflicting requirements, testable properties）がテンプレート条件（C）でのみ出現する——を、統計的に検証可能な実験設計で再現・検証する。加えて、D 条件（構造化チェックリスト、論文形式なし）を導入し、テンプレート効果を論文形式効果から分離する。

---

## 2. 仮説

### H_main（主仮説）

PDD テンプレート条件（C）は、通常プロンプト（A）、論文形式指示（B）、および構造化チェックリスト（D）と比較して、co-primary 2指標（conflicting requirements identified, testable properties derived）の出現率が有意に高い。

- 帰無仮説 H0: 4条件間で co-primary 2指標に差はない
- 対立仮説 H1: C 条件は他の3条件より co-primary 2指標が高い

### H_framing（副仮説1: フレーミング効果）

論文形式指示（B）は、通常プロンプト（A）と比較して、探索幅（existing approaches analyzed）が広い。ただし、co-primary 2指標には差がない。

- H0: A と B で existing approaches analyzed に差はない
- H1: B > A（探索幅）
- 追加予測: B と A の co-primary 2指標は共にゼロ付近で差がない

### H_checklist（副仮説2: チェックリスト効果）

D 条件（構造化チェックリスト）は C 条件（PDD テンプレート）と同等または有意に低い co-primary 2指標を示す。

- H0: C と D で co-primary 2指標に差はない
- H1: C > D（テンプレート効果 > チェックリスト効果）

この仮説の結果は3通りの解釈を持つ:
- **D ≈ C**: 分析ステップの構造化が重要であり、論文形式は必須ではない → テンプレート効果はチェックリスト効果に還元される
- **D < C**: 論文形式（学術的フレーミング）がチェックリスト以上の付加価値を持つ
- **D ≈ A/B**: チェックリスト単体では効果がなく、論文形式との組み合わせが必要

---

## 3. 条件定義

### 3.1 条件一覧

| 条件 | ラベル | 概要 |
|------|--------|------|
| A | Conventional | 通常の設計分析プロンプト |
| B | Paper-format | 論文形式指示（テンプレートなし） |
| C | PDD Template | 論文形式指示 + §1–§7 テンプレートガイドライン |
| D | Structured Checklist | 構造化チェックリスト（論文形式なし） |

### 3.2 各条件のプロンプト（日本語）

すべての条件で、問題記述部分は同一。指示プレフィックスのみが異なる。

**条件 A: Conventional**

```
以下の技術的な問題について、設計分析と解決策を提案してください。

[問題記述]
```

**条件 B: Paper-format**（= Phase 1 の B1）

```
以下の技術的な問題について、学術論文の形式で書いてください。

[問題記述]
```

**条件 C: PDD Template**

```
以下の技術的な問題について、学術論文の形式で書いてください。

以下のセクション構造に従ってください:

§1. 問題定義
  §1.1 背景
  §1.2 矛盾する要求（対立するトレードオフ）— 2つ以上特定すること
  §1.3 本文書の範囲
§2. 現状のアーキテクチャと制約
§3. 既存アプローチとその限界
  §3.N アプローチN: [名前] — 手法 / 利点 / 限界
§4. 問題の本質
§5. 提案手法
  §5.1 基本原理
  §5.2 実装アーキテクチャ
§6. 検証可能な性質 — Given/When/Then 形式で定義すること
§7. 制約と今後の課題

[問題記述]
```

**条件 D: Structured Checklist**

```
以下の技術的な問題について、以下の分析項目に従って順番に分析してください。各項目について具体的に記述してください。

1. 問題の背景と文脈
2. 対立する要求やトレードオフ — 2つ以上特定すること
3. 分析の対象範囲
4. 現状のアーキテクチャと制約
5. 既存の解決アプローチとその限界
  5.N アプローチN: [名前] — 手法 / 利点 / 限界
6. 問題の本質的な困難
7. 解決策
  7.1 基本原理
  7.2 実装方針
8. 検証条件 — Given/When/Then 形式で定義すること
9. 制約、限界、今後の課題

[問題記述]
```

### 3.3 D 条件の設計根拠

D 条件は C 条件と同一の分析ステップ・同一の粒度を要求するが、フレーミングのみが異なる:

| 要素 | C（PDD Template） | D（Structured Checklist） |
|------|-------------------|--------------------------|
| 指示フレーミング | 「学術論文の形式で書いてください」 | 「分析項目に従って分析してください」 |
| 構造表記 | §1–§7（論文セクション番号） | 1–9（番号付きリスト） |
| 階層構造 | §1.1/§1.2/§1.3, §3.N, §5.1/§5.2 | 項目2・3で対応, 5.N, 7.1/7.2 |
| 分析項目数 | 同一（9項目） | 同一（9項目） |
| 各項目の粒度 | サブセクション指定あり（§3.N, §5.1/§5.2） | サブ項目指定あり（5.N, 7.1/7.2） |
| GWT 形式指定 | あり（§6） | あり（項目8） |
| 矛盾する要求の要求 | あり（§1.2: 2つ以上） | あり（項目2: 2つ以上） |

C と D の系統的差異は**フレーミング**（学術論文 vs 技術分析）に限定するよう設計した。構造の粒度（サブ項目の有無、アプローチごとの手法/利点/限界の指定）は同型化した。

### 3.4 需要特性に関する注記

C 条件と D 条件は co-primary 指標に対応する分析ステップ（「矛盾する要求を2つ以上」「GWT 形式の検証条件」）を直接要求している。このため、co-primary 指標の計測はプロンプト遵守率の側面を持つ。

これは意図的な設計である。本実験の問いは「LLM が自発的にこれらの分析を行うか」ではなく:
- **A/B vs C/D**: 明示的な要求がなければ出現しない情報が、要求により外在化されるか（情報外在化効果の確認）
- **C vs D**: 同一の要求を与えた場合に、学術論文フレーミングがチェックリストフレーミングに対して付加価値を持つか（フレーミング効果の分離）

A/B 条件はこれらの項目を要求しないため、「要求なしでの自発的出現」のベースラインを提供する。

### 3.5 問題記述

Phase 1 と同一の2ケーススタディを使用する。

**CS1: RAG ストリーミング引用リナンバリング**

```
RAGシステムでは、LLMが検索結果（例: source_3, source_7）を参照しながらストリーミングで回答を生成します。ユーザーには [1], [2], [3] のような読みやすい連番で引用を表示したいのですが、ストリーミング中は全文が確定していないため、最終的にどの引用が使われるかわかりません。

以下の要件を満たす設計を分析してください:
- ストリーミング中にリアルタイムで引用番号を表示する
- 一度表示した番号が後から変わらない
- ストリーム完了時にソース一覧と整合している
```

**CS2: マルチテナント SaaS セッション管理**

```
マルチテナントSaaSのセッション管理システムを設計する必要があります。

以下の要件を同時に満たす必要があります:
- 同一ユーザーの複数端末からの同時ログインをサポートする
- 管理者が特定ユーザーのセッションを即座に無効化できる
- 水平スケーリングに対応する（サーバー台数を増減できる）
- リクエスト認証のレイテンシを最小化する
```

---

## 4. 実験プロトコル

### 4.1 実行環境

- **モデル**: GPT-5.2（via Codex CLI）
  - Phase 1 と同一モデル・同一アクセス方法
- **温度パラメータ**: デフォルト（明示的な設定なし）
- **コンテキスト**: 各実行は独立した新規 Codex スレッドで実施
  - 先行する会話履歴なし
  - 他の条件の出力を参照しない

### 4.2 実行計画

| 要素 | 値 |
|------|-----|
| 条件数 | 4（A, B, C, D） |
| ケーススタディ数 | 2（CS1, CS2） |
| 反復回数 | 5 |
| 総実行回数 | 4 × 2 × 5 = **40** |

### 4.3 実行手順

1. 各実行について、新規 Codex スレッドを開く
2. 該当する条件のプロンプト（§3.2）に問題記述（§3.5）を組み合わせて入力
3. LLM の出力が完了するまで待機
4. 出力全文を保存

### 4.4 実行順序

- 実行順序はランダム化する（条件×ケーススタディの組み合わせをシャッフル）
- 順序効果を排除するため、1日に特定条件を集中させない

### 4.5 出力の保存

- 保存先: `docs/examples/fullpaper/`
- 命名規則: `cs{1,2}-{condition}-run{1-5}.md`
  - 例: `cs1-conventional-run1.md`, `cs2-checklist-run3.md`
- 各ファイルのヘッダに実行メタデータを記録:
  ```
  > **Run**: CS1-A-Run1
  > **Date**: YYYY-MM-DD
  > **Thread**: [新規/既存]
  > **Model**: GPT-5.2 (via Codex)
  ```

### 4.6 除外基準

以下の場合、当該実行を除外し、代替実行を行う:

- API エラーにより出力が中断された
- 出力が明らかに切れている（文の途中で終了）
- Codex スレッドのコンテキスト圧縮が発生した
- 誤ったプロンプトで実行した

除外した実行は理由とともに `docs/examples/fullpaper/excluded/` に保存する。

---

## 5. 評価ルーブリック v2

### 5.1 Co-primary 指標

#### 5.1.1 Conflicting requirements identified（矛盾する要求）

**定義**: 明示的に述べられた、対立する要求またはトレードオフのペア数。

**カウントルール**:
- 形式的に定義されたペア（「X vs Y」「X と Y は対立する」等）を1ペアとしてカウント
- カウント単位は**無向ユニークペア**（{X, Y} と {Y, X} は同一）
- 暗黙的な言及（「X と Y のバランスを取る」等、形式的定義なし）はカウントしない
- 同一のトレードオフが異なる表現で言い換えられた場合は1ペアとしてカウント（重複排除）
- 三項トレードオフ（例: 「A vs B vs C」）は二項ペアに分解してカウント（{A,B}, {A,C}, {B,C} = 3ペア）。ただし出力が三項を一括して述べ個別ペアを分離していない場合は1ペアとしてカウント

**カウント例（Phase 1 データより）**:

| 例 | カウント | 理由 |
|-----|---------|------|
| 「(A) リアルタイム表示 vs (B) グローバル整合のある連番」（CS1-C） | 1 | 形式的に対立ペアとして定義 |
| 「即時失効 vs 低レイテンシ」（CS2-C） | 1 | 形式的に対立ペアとして定義 |
| 「水平スケーリング vs 管理可能性」（CS2-C） | 1 | 形式的に対立ペアとして定義 |
| 「レイテンシとスケーラビリティのバランス」（CS2-A、暗黙的） | 0 | ペアとして形式的に定義されていない |
| CS2-B1: 文中で対立を語るが対を列挙しない（rescoring 不一致の例） | 0 | 物語的言及は形式定義として不十分 |

**境界ケース**:
- 「副次的」と明示された対立（例: CS2-C の3番目の対立）もカウント対象
- 問題記述中に暗示されたトレードオフを LLM が形式化した場合はカウント対象
- LLM が問題記述の要件を並列に列挙しただけ（対立構造を明示しない）はカウント対象外

#### 5.1.2 Testable properties derived（導出されたテスト可能な性質）

**定義**: 提案手法から導出された、テストケースに変換可能な具体的な条件の数。

**カウントルール**:
- 1テスト性質は以下の3要素を含むものとして定義: {前提状態(Given), 操作(When), 観測可能な期待値(Then)}
- 3要素が明示的に揃っている場合のみ1性質としてカウント（Given/When/Then 形式でなくても、3要素が文脈から一意に特定できればカウント）
- 3要素のうちいずれかが欠けている記述はカウントしない（例: 「精度は100%であるべき」は操作と前提が不明なため0）
- 同一の前提状態に対して異なる期待値を持つ性質は、それぞれ別にカウント
- 同一内容の言い換えは重複排除（1カウント）
- **重要な区別**: 問題の入力要件（問題レベルの仕様）と、提案手法から導出されたテスト性質（解法レベルの検証可能な振る舞い）を区別する

**カウント例（Phase 1 データより）**:

| 例 | カウント | 理由 |
|-----|---------|------|
| 「Given body が [source_7]...[source_3] の順にストリーミング, when 逐次レンダリング, then 表示は [1]...[2]」（CS1-C §6-1） | 1 | 提案手法（初出順採番）の振る舞いを検証 |
| 「Given 管理者が sid を失効, when 失効通知が配信, then 次回リクエストは拒否」（CS2-C §6-2） | 1 | 提案手法（user_epoch+Pub/Sub）の振る舞いを検証 |
| 「要件R1: 一度表示した引用番号が変わらない」（CS1-B2 §2） | **0** | 問題の入力要件であり、提案手法からの導出ではない |
| 「要件R1–R4」（CS1-B2 §2） | **0** | 問題レベルの仕様（何をすべきか）であり、解法の検証（どう振る舞うか）ではない |

**境界ケースの判定フロー**:
1. この条件は「提案手法が存在しなくても記述できるか？」→ Yes なら入力要件（カウント対象外）
2. この条件は「提案手法の特定のメカニズムを前提としているか？」→ Yes ならテスト性質（カウント対象）

例: 「番号が変わらない」は提案手法なしでも要件として記述できる → 入力要件（0）。「Given L1 キャッシュにエントリが存在, when 検証実行, then Redis への問い合わせなしに判定」は提案手法（L1キャッシュ設計）を前提 → テスト性質（1）。

### 5.2 Exploratory 指標

#### 5.2.1 Constraints disclosed（制約の開示）

**定義**: 提案手法の明示的な限界、境界条件、または不適用条件の数。

**カウントルール**:
- 提案手法が機能しない条件、または劣化する条件を1つにつき1カウント
- 「さらなる検討が必要」等の一般的免責事項はカウントしない

**カウント対象の例**:
- 「採番規則を初出順とする（これを外すと確定できない）」→ 1（前提条件 = 適用限界）
- 「Redis 依存性：単一障害点になり得る」→ 1（提案手法の具体的限界）
- 「マルチリージョン時に伝播遅延が発生」→ 1（スケーラビリティの限界）

**カウント対象外の例**:
- 「今後の検証が必要」→ 0（一般的免責）
- 「セキュリティの詳細は別途設計が必要」→ 0（範囲外への言及であり提案手法の限界ではない）
- 「構造化出力スキーマへの移行を検討」→ 0（改善提案であり現手法の限界記述ではない）

**ステータス**: Phase 1 で自己盲検再採点の一致率が 30% であったため、exploratory 指標に分類する。本実験では記録するが、主張の根拠には使用しない。ルーブリック v2 での定義精緻化により一致率向上を目指す。

### 5.3 Secondary 指標

#### 5.3.1 Existing approaches analyzed（既存アプローチ分析数）

**定義**: 列挙かつ評価された代替アプローチの数。

**カウントルール**:
- 手法の説明 + 利点または限界の記述がある場合に1カウント
- 名前だけの言及（評価なし）はカウントしない
- 提案手法自体は代替アプローチとしてカウントしない

#### 5.3.2 Formal invariants/proofs（形式的不変条件・証明）

**定義**: 数学的または論理的に形式化された性質（定義、定理、証明）の数。

**カウントルール**:
- 数学的記法を用いた形式定義を1つにつき1カウント
- 非形式的な推論はカウントしない

#### 5.3.3 Total output length（総出力行数）

**定義**: LLM 出力の行数（メタデータヘッダー除外、空行含む）。

### 5.4 行あたり正規化

co-primary 指標および exploratory 指標について、以下の正規化値も算出する:

- normalized_conflicting = conflicting_requirements / total_lines × 100
- normalized_testable = testable_properties / total_lines × 100
- normalized_constraints = constraints_disclosed / total_lines × 100

出力量と指標の交絡を制御するための感度分析に使用する。

---

## 6. 著者による1次採点

### 6.1 手順

1. 各出力（40件）について、ルーブリック v2（§5）に基づき全指標をカウント
2. 各カウントの根拠（該当箇所の引用）を記録
3. 全採点を `paper/scoring-data-v2.md` に記録

### 6.2 記録フォーマット

各出力について以下を記録:

```markdown
### CS1-A-Run1
| Indicator | Count | Evidence |
|-----------|------:|---------|
| Conflicting requirements | 0 | （暗黙的な言及のみ、形式的定義なし） |
| Testable properties | 0 | （なし） |
| Constraints disclosed | 1 | 「〇〇の場合は適用できない」(L42) |
| Existing approaches | 2 | アプローチ1: △△ (L15-20), アプローチ2: □□ (L25-30) |
| Formal invariants | 0 | （なし） |
| Total lines | 65 | — |
```

---

## 7. 統計解析計画

### 7.1 サンプルサイズの根拠

N=5/セル（合計40実行）は正式な検出力分析に基づくものではなく、実行コスト（API 費用、手動採点の工数）と最低限の統計的検証可能性のバランスから決定した。Phase 1（N=1/セル）の効果が大きい（co-primary 指標が C でのみ非ゼロ）ため、N=5 でも検出可能と見込むが、小さな効果の検出には不十分な可能性がある。この限界は論文で明記する。

### 7.2 主解析（H_main）

**主解析は二本立て**で事前登録する:

**主解析 A: 外在化効果**（明示的要求の有無）
- 検定: ケーススタディで層別した置換検定
- 比較: {C, D}（明示的要求あり）vs {A, B}（明示的要求なし）
- 従属変数: co-primary 各指標のカウント
- 統計量: 層別平均差（群間平均差を各層で算出し、層の平均を取る）
- 片側検定（{C,D} > {A,B} の方向）
- 置換方法: 各層（CS1, CS2）内でラベルを再割り当てし、層別統計量を再算出
- 置換回数: 10,000（乱数シード: 42、再現性のため固定）
- 有意水準: α = 0.025 per indicator（Bonferroni 補正、2 co-primary 指標）

**主解析 B: フレーミング効果**（主張の中核）
- 検定: ケーススタディで層別した置換検定
- 比較: C vs D（同一の分析ステップ要求、フレーミングのみ異なる）
- 従属変数: co-primary 各指標のカウント
- 統計量・片側・置換方法・回数・シード: 主解析 A と同一
- 有意水準: α = 0.025 per indicator（Bonferroni 補正）

**事後ペアワイズ比較**: 主解析 A が有意な場合
- C vs A, C vs B, D vs A, D vs B の各ペアで層別置換検定
- Bonferroni 補正（α = 0.025 / 4 ≈ 0.006 per pair per indicator）

**効果量**: Cliff's delta（各ペアワイズ比較）+ 95% ブートストラップ信頼区間（10,000回）

**補助解析**: Poisson 回帰（`count ~ condition + case_study`）を感度分析として実施。小標本のためブートストラップ信頼区間を併用。

### 7.3 副解析（H_framing: 探索幅）

**検定**: 層別置換検定
- 比較: B vs A（existing approaches analyzed）
- 層別因子: ケーススタディ
- 統計量・片側（B > A）・置換方法: 主解析と同一
- 有意水準: α = 0.05（探索的、補正なし。その旨を明記）
- 効果量: Cliff's delta

### 7.4 同等性検定（H_checklist: D ≈ C の場合）

主解析 B で C vs D が非有意の場合、「差がない」とは主張できない。D ≈ C を積極的に主張するために:

**検定**: 層別 TOST（Two One-Sided Tests）置換検定
- 等価マージン（Δ）: Phase 1 の C 条件平均値の 50% を事前に設定
  - conflicting requirements: Δ = 1.25（Phase 1 平均 2.5 の 50%）
  - testable properties: Δ = 3.25（Phase 1 平均 6.5 の 50%）
- 有意水準: α = 0.05
- 結果の解釈:
  - TOST 有意: D ≈ C（チェックリストで十分、フレーミング不要）
  - TOST 非有意 かつ 主解析 B 有意: C > D（フレーミングが付加価値）
  - 両方非有意: 検出力不足、結論保留

### 7.5 感度分析

1. **行あたり正規化**: 正規化値（§5.4）で主解析を再実行
2. **ケーススタディ別**: CS1 と CS2 で効果の方向が一致するか確認
3. **Exploratory 指標**: constraints disclosed についても同一の検定を実行（結果は exploratory として報告）
4. **Poisson 回帰**: `count ~ condition + case_study`（ブートストラップ CI 併用）

### 7.6 成功判定基準

- **H_main の完全支持**: 主解析 A（外在化効果）および主解析 B（フレーミング効果）の両方で、co-primary 2指標の両方が有意
- **部分的支持（外在化のみ）**: 主解析 A は有意だが主解析 B は非有意 → 「明示的要求は効果があるが、フレーミングの付加価値は未確認」
- **部分的支持（1指標のみ）**: co-primary 2指標のうち1つのみ有意 → 結論を当該指標に限定
- **不支持**: 主解析 A が非有意 → Phase 1 の観察パターンが再現されない

---

## 8. 第三者盲検評価

### 8.1 目的

著者評価のバイアスを排除し、inter-rater reliability を確立する。

### 8.2 評価者の募集

- **人数**: 2名以上
- **条件**: ソフトウェア開発の実務経験（3年以上目安）
- **独立性**: 論文の内容・仮説を事前に知らない人物が望ましい
- **謝礼**: 明示する（金額は募集時に決定）

### 8.3 評価パッケージ

評価者に提供する資料:

1. **ルーブリック v2**（§5 の内容）
   - 各指標の定義
   - カウントルール
   - 具体例（Phase 1 データより 2-3 件/指標）
   - 境界ケースの判定フロー
2. **採点シートテンプレート**
   - 各出力ファイルに対して指標ごとのカウント欄
   - 根拠（該当箇所の引用）記入欄
3. **手順書**
   - 所要時間の見積もり: 60-90 分
   - 各ファイルを通読 → 指標ごとにカウント → 根拠を記録
   - 不明な場合の判断基準（「迷ったらカウントしない」）

### 8.4 校正ラウンド（Calibration）

1. Phase 1 の出力から 3-5 件を選定（条件のバランスを考慮）
2. 著者 + 評価者2名が独立に採点
3. 不一致箇所を議論し、ルーブリック解釈を合意
4. 必要に応じてルーブリック v2 を微調整（調整理由を記録）
5. 校正後のルーブリックを確定版とする

### 8.5 本番盲検

1. 40 件の出力から条件ラベル・ファイル名を除去
2. ランダム順に並べ替え（乱数シードを記録）
3. 各評価者が独立に co-primary 2指標を採点
   - Exploratory 指標（constraints disclosed）も採点するが、主分析には使用しない
4. 評価者間のコミュニケーションなし
5. 各出力について、評価者に「この出力はどの条件で生成されたと推測するか」を記録させる（盲検の実効性検証用）

**盲検の限界（単盲検）**: 条件ラベルは除去するが、出力の形式的特徴（§構造 = C、チェックリスト構造 = D、論文形式 = B 等）から条件を推定できる可能性がある。このため本手順は厳密な二重盲検ではなく**単盲検**として位置づける。評価者の条件推定精度を報告し、推定可能性が採点バイアスに与える影響を議論する。

### 8.6 信頼性の評価

**主指標**: ICC（Intraclass Correlation Coefficient, two-way random, absolute agreement）
- 生カウント値に対して算出（二値化しない）
- 各指標について ICC を報告

**補助指標**: Krippendorff's α（順序尺度）
- ICC と併せて報告し、ロバストネスを確認

**合格基準**: ICC ≥ 0.60（moderate agreement 以上）
- **未達の場合**: ルーブリック再校正 → 再採点（最大2ラウンド）
- 2ラウンド後も未達の場合: 当該指標を exploratory に降格

### 8.7 不一致の解決

- ゼロ/非ゼロの不一致: 第3評価者が独立に裁定（合議ではなく独立採点）
- カウント数の不一致（両者とも非ゼロ）: 中央値ルール（評価者2名なら平均を四捨五入、3名なら中央値）
- 全不一致のパターンを記録し、ルーブリックの改善に活用

---

## 9. 中止基準

### 9.1 実験レベル

- D 条件で C と統計的に同等の co-primary 指標が出た場合: テンプレート効果の主張は成立しない。チェックリスト効果の研究に方向転換を検討
- 全条件で co-primary 指標が非ゼロとなった場合: Phase 1 の観察パターンが再現されない。原因分析（モデルバージョン、プロンプト変更等）を実施

### 9.2 盲検評価レベル

- ICC < 0.40（2ラウンド後）: 当該指標を主張の根拠から除外
- 評価者の辞退: 代替評価者を募集（最低2名を維持）

---

## 10. 固定パラメータと予備データの扱い

### 10.1 モデル設定の固定

| パラメータ | 値 | 備考 |
|-----------|-----|------|
| モデル | GPT-5.2 | Phase 1 と同一 |
| アクセス方法 | Codex CLI (OpenAI) | Phase 1 と同一 |
| Temperature | デフォルト（明示設定なし） | Codex CLI のデフォルト値 |
| Max tokens | 未制限（Codex デフォルト） | 出力切れは除外基準で対応 |
| System prompt | なし | 条件プロンプトのみ |
| コンテキスト | 各実行は新規スレッド | 先行会話履歴なし |

**ランタイムメタデータの記録**: 各実行ごとに以下を保存する:
- Codex CLI バージョン（`codex --version` の出力）
- 実行日時（UTC）
- 実際の API レスポンスに含まれるモデル識別子（可能な場合）
- スレッド ID（再現性の参照用）

これらのメタデータは各出力ファイルのヘッダに記録する。

### 10.2 予備実験データの扱い

- Phase 1 のデータ（N=1/セル、3条件+Bバリアント）は**本解析に含めない**
- Phase 1 データは「先行観察」として論文の動機付けにのみ使用する
- Step 2.1（D 条件予備実験、各 CS 1-2 回）のデータも**本解析に含めない**
- 予備実験は D 条件プロンプトの妥当性確認のみに使用し、プロンプト調整の根拠として記録する

### 10.3 除外・再実行の上限

- 各条件×ケーススタディについて、除外は最大2回まで（= 最大7回実行して5回分のデータを取得）
- 3回以上の除外が発生した場合は、当該条件の安定性に問題があるとして論文に報告する

### 10.4 解析スクリプトの固定

- 統計解析スクリプトは `paper/analysis/` に保存し、プロトコル固定時に Git tag に含める
- 解析スクリプトのバージョンと実行環境（Python/R バージョン、ライブラリバージョン）を記録する

---

## 11. 逸脱の記録

プロトコル固定後のすべての逸脱は、以下の形式で記録する:

```markdown
### 逸脱 #N (YYYY-MM-DD)
- **対象**: [該当するプロトコルセクション]
- **内容**: [何を変更したか]
- **理由**: [なぜ変更が必要だったか]
- **影響**: [結果の解釈にどう影響するか]
```

逸脱記録は `paper/protocol-deviations.md` に保存する。

---

## 12. タイムライン（目安）

| ステップ | 内容 | 依存関係 |
|----------|------|----------|
| 2.0 | プロトコル固定（本文書） | — |
| 2.1 | D 条件予備実験（各CS 1-2回） | 2.0 完了 |
| 2.2 | N拡張実験（40回実行 + 著者採点） | 2.1 完了 |
| 2.3 | 第三者盲検評価 | 2.2 完了 + 評価者確保 |
| 2.4 | 外的妥当性（追加1モデル or 1ドメイン） | 2.3 の κ 合格 |

---

## 13. 成果物一覧

| 成果物 | 保存先 |
|--------|--------|
| 本プロトコル | `paper/protocol-v1.md` |
| LLM 出力（40件） | `docs/examples/fullpaper/cs{1,2}-{condition}-run{1-5}.md` |
| 著者採点データ | `paper/scoring-data-v2.md` |
| 盲検採点データ | `paper/blinded-scoring-v2.md` |
| 統計解析結果 | `paper/analysis-results-v2.md` |
| 逸脱記録 | `paper/protocol-deviations.md` |
| 改訂版論文 | `paper/paper-driven-dev.md` |

---

## Appendix: Phase 1 からの変更点

| 項目 | Phase 1 | Phase 2（本プロトコル） |
|------|---------|----------------------|
| 条件数 | 3（A/B/C）+ B バリアント（B1/B2/B3） | 4（A/B/C/D） |
| 反復数 | 1（各条件×各CS） | 5（各条件×各CS） |
| 総実行数 | 10（3×2 + Bバリアント 2×2） | 40（4×2×5） |
| 評価者 | 著者のみ（+ AI 再採点） | 著者 + 第三者2名以上 |
| co-primary 指標 | 3（後に2に修正） | 2（conflicting req., testable prop.） |
| 統計検定 | なし（記述統計のみ） | 層別置換検定 + Poisson 回帰 |
| 盲検 | Self-blinded AI rescoring | 第三者盲検 |
| ルーブリック | v1（境界ケース不明確） | v2（具体例+判定フロー付き） |
