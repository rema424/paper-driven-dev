# 評価ルーブリック v2

> **Version**: v2
> **Source**: Protocol v1 §5
> **Purpose**: 第三者評価者がこの文書のみで全出力を独立に採点できること

---

## 1. 指標一覧

| 分類 | 指標 | 略称 | 概要 |
|------|------|------|------|
| **Co-primary** | Conflicting requirements identified | CR | 明示的に述べられた対立する要求ペア数 |
| **Co-primary** | Testable properties derived | TP | 提案手法から導出されたテスト可能な性質の数 |
| **Exploratory** | Constraints disclosed | CD | 提案手法の明示的な限界・境界条件の数 |
| **Secondary** | Existing approaches analyzed | EA | 列挙かつ評価された代替アプローチの数 |
| **Secondary** | Formal invariants/proofs | FI | 数学的または論理的に形式化された性質の数 |
| **Secondary** | Total output length | TL | 出力の行数（メタデータヘッダ除外、空行含む） |

**Co-primary 指標**（CR, TP）が本研究の主要な分析対象です。すべての指標について同じ注意を払って採点してください。

---

## 2. 全般原則

1. **迷ったらカウントしない**: 判断に迷う場合はカウントしない。過大カウントより過小カウントを優先する。
2. **エビデンス必須**: すべてのカウントについて、該当箇所の引用（行番号または文の引用）を記録する。
3. **独立性**: 他の評価者の採点結果を参照しない。不明点があればルーブリックを再読する。
4. **重複排除**: 同一内容が異なる表現で繰り返されている場合は1回としてカウントする。
5. **出力ごとに独立判断**: 他の出力との比較ではなく、各出力を単独でルーブリックに照らして採点する。

---

## 3. Co-primary 指標

### 3.1 Conflicting Requirements Identified（CR: 矛盾する要求）

**定義**: 明示的に述べられた、対立する要求またはトレードオフのペア数。

#### カウントルール

- 形式的に定義されたペア（「X vs Y」「X と Y は対立する」等）を **1ペア** としてカウント
- カウント単位は **無向ユニークペア**（{X, Y} と {Y, X} は同一）
- 暗黙的な言及（「X と Y のバランスを取る」等、形式的定義なし）は **カウントしない**
- 同一のトレードオフが異なる表現で言い換えられた場合は **1ペア** としてカウント（重複排除）
- 三項トレードオフ（「A vs B vs C」）は二項ペアに分解（{A,B}, {A,C}, {B,C} = 3ペア）。ただし出力が三項を一括して述べ個別ペアを分離していない場合は **1ペア** としてカウント

#### 判定フローチャート

```
候補テキストを発見
  │
  ├─ 対立する2つの要求/性質が明示的に名前付けされているか？
  │   ├─ No → カウントしない（暗黙的言及）
  │   └─ Yes ↓
  │
  ├─ 両者が対立・トレードオフ関係にあることが明示されているか？
  │   ├─ No → カウントしない（並列列挙にすぎない）
  │   └─ Yes ↓
  │
  ├─ 既にカウント済みの別ペアと実質同一か？
  │   ├─ Yes → カウントしない（重複排除）
  │   └─ No → 1ペアとしてカウント ✓
  │
  └─ [三項以上の場合] 個別ペアが分離されているか？
      ├─ Yes → 二項ペアに分解してカウント
      └─ No → 1ペアとしてカウント
```

#### 具体例

| 例 | カウント | 理由 |
|----|:-------:|------|
| 「(A) リアルタイム表示 vs (B) グローバル整合のある連番」 | 1 | 形式的に対立ペアとして定義 |
| 「即時失効 vs 低レイテンシ」 | 1 | 形式的に対立ペアとして定義 |
| 「水平スケーリング vs 管理可能性」 | 1 | 形式的に対立ペアとして定義 |
| 「レイテンシとスケーラビリティのバランス」（暗黙的） | 0 | ペアとして形式的に定義されていない |
| 文中で対立を語るがペアを列挙しない記述 | 0 | 物語的言及は形式定義として不十分 |

#### 境界ケース

- 「副次的」と明示された対立（例: 3番目の対立）→ **カウント対象**
- 問題記述中に暗示されたトレードオフを出力が形式化した場合 → **カウント対象**
- 出力が問題記述の要件を並列に列挙しただけ（対立構造を明示しない）→ **カウント対象外**

---

### 3.2 Testable Properties Derived（TP: 導出されたテスト可能な性質）

**定義**: 提案手法から導出された、テストケースに変換可能な具体的な条件の数。

#### カウントルール

- 1テスト性質は以下の **3要素** を含むものとして定義:
  - **前提状態（Given）**: テスト開始時の状態
  - **操作（When）**: 実行するアクション
  - **観測可能な期待値（Then）**: 検証する結果
- 3要素が明示的に揃っている場合のみ1性質としてカウント（Given/When/Then 形式でなくても、3要素が文脈から一意に特定できればカウント）
- 3要素のうち **いずれかが欠けている** 記述はカウントしない（例: 「精度は100%であるべき」は操作と前提が不明なため0）
- 同一の前提状態に対して異なる期待値を持つ性質は **それぞれ別にカウント**
- 同一内容の言い換えは重複排除（1カウント）

#### 重要な区別: 入力要件 vs テスト性質

| 種類 | 説明 | カウント |
|------|------|:-------:|
| **入力要件**（問題レベルの仕様） | 提案手法が存在しなくても記述できる条件 | 0 |
| **テスト性質**（解法レベルの検証可能な振る舞い） | 提案手法の特定のメカニズムを前提とした条件 | 1 |

#### 判定フローチャート

```
候補テキストを発見
  │
  ├─ 3要素（前提状態 / 操作 / 期待値）がすべて特定可能か？
  │   ├─ No → カウントしない（不完全な仕様記述）
  │   └─ Yes ↓
  │
  ├─ この条件は「提案手法が存在しなくても記述できるか？」
  │   ├─ Yes → カウントしない（入力要件）
  │   └─ No ↓
  │
  ├─ この条件は「提案手法の特定のメカニズムを前提としているか？」
  │   ├─ No → カウントしない
  │   └─ Yes ↓
  │
  ├─ 既にカウント済みの別性質と実質同一か？
  │   ├─ Yes → カウントしない（重複排除）
  │   └─ No → 1性質としてカウント ✓
  │
  └─ 同一前提で異なる期待値がある場合 → それぞれ別にカウント
```

#### 具体例

| 例 | カウント | 理由 |
|----|:-------:|------|
| 「Given body が [source_7]...[source_3] の順にストリーミング, when 逐次レンダリング, then 表示は [1]...[2]」 | 1 | 提案手法（初出順採番）の振る舞いを検証 |
| 「Given 管理者が sid を失効, when 失効通知が配信, then 次回リクエストは拒否」 | 1 | 提案手法（user_epoch+Pub/Sub）の振る舞いを検証 |
| 「Given L1 キャッシュにエントリが存在, when 検証実行, then Redis への問い合わせなしに判定」 | 1 | 提案手法（L1キャッシュ設計）を前提 |
| 「要件R1: 一度表示した引用番号が変わらない」 | 0 | 問題の入力要件であり、提案手法からの導出ではない |
| 「精度は100%であるべき」 | 0 | 操作と前提が不明（3要素不足） |

---

## 4. Exploratory 指標

### 4.1 Constraints Disclosed（CD: 制約の開示）

**定義**: 提案手法の明示的な限界、境界条件、または不適用条件の数。

> **注意**: この指標は exploratory です。採点は行いますが、主要な主張の根拠には使用しません。

#### カウントルール

- 提案手法が **機能しない条件** または **劣化する条件** を1つにつき1カウント
- 「さらなる検討が必要」等の **一般的免責事項はカウントしない**

#### カウント対象の例

| 例 | カウント | 理由 |
|----|:-------:|------|
| 「採番規則を初出順とする（これを外すと確定できない）」 | 1 | 前提条件 = 適用限界 |
| 「Redis 依存性: 単一障害点になり得る」 | 1 | 提案手法の具体的限界 |
| 「マルチリージョン時に伝播遅延が発生」 | 1 | スケーラビリティの限界 |

#### カウント対象外の例

| 例 | カウント | 理由 |
|----|:-------:|------|
| 「今後の検証が必要」 | 0 | 一般的免責 |
| 「セキュリティの詳細は別途設計が必要」 | 0 | 範囲外への言及 |
| 「構造化出力スキーマへの移行を検討」 | 0 | 改善提案であり現手法の限界記述ではない |

---

## 5. Secondary 指標

### 5.1 Existing Approaches Analyzed（EA: 既存アプローチ分析数）

**定義**: 列挙かつ評価された代替アプローチの数。

#### カウントルール

- 手法の説明 **+** 利点または限界の記述がある場合に1カウント
- 名前だけの言及（評価なし）は **カウントしない**
- 提案手法自体は代替アプローチとして **カウントしない**

### 5.2 Formal Invariants/Proofs（FI: 形式的不変条件・証明）

**定義**: 数学的または論理的に形式化された性質（定義、定理、証明）の数。

#### カウントルール

- 数学的記法を用いた形式定義を1つにつき1カウント
- 非形式的な推論は **カウントしない**

### 5.3 Total Output Length（TL: 総出力行数）

**定義**: LLM 出力の行数。

#### カウントルール

- メタデータヘッダ（タイトル行〜最初の `---` まで）を **除外**
- 空行を **含む**
- `wc -l` 相当（最終行に改行がなくてもカウント）

---

## 6. 採点の注意事項

### 各指標の独立性

- 各指標は独立にカウントしてください。ある指標のカウントが他の指標に影響しません。
- たとえば、CR でカウントしたトレードオフに関連する記述が CD にも該当する場合、それぞれ独立にカウントします。

### エビデンスの記録

すべてのカウントについて、以下のいずれかの形式で根拠を記録してください:

- **行番号参照**: 「L42: 即時失効 vs 低レイテンシ」
- **テキスト引用**: 「"即時失効 vs 低レイテンシ"」

カウント = 0 の場合は「none」と記録してください。
